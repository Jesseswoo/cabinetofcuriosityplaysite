<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Neotoma Part I: retrieving all the mammal data - Cabinet of Curiosity</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Cabinet of Curiosity" property="og:site_name">
  
    <meta content="Neotoma Part I: retrieving all the mammal data" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="Connecting to and downloading awesome data from the Neotoma database" property="og:description">
  
  
    <meta content="http://localhost:4000/retrieving-summary-neotoma/" property="og:url">
  
  
    <meta content="2018-03-19T14:00:00-07:00" property="article:published_time">
    <meta content="http://localhost:4000/about/" property="article:author">
  
  
    <meta content="http://localhost:4000/assets/img/neotoma_part1.png" property="og:image">
  
  
    
  
  
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@ofcuriositydata">
  
    <meta name="twitter:title" content="Neotoma Part I: retrieving all the mammal data">
  
  
    <meta name="twitter:url" content="http://localhost:4000/retrieving-summary-neotoma/">
  
  
    <meta name="twitter:description" content="Connecting to and downloading awesome data from the Neotoma database">
  
  
    <meta name="twitter:image:src" content="http://localhost:4000/assets/img/neotoma_part1.png">
  

	<meta name="description" content="Connecting to and downloading awesome data from the Neotoma database">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicon/apple-touch-icon-114x114.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">
</head>

<body>

  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/"><img src="/assets/img/david-freeman.jpg" alt="Cabinet of Curiosity"></a>
      </div>
      <div class="author-name">Cabinet of Curiosity</div>
      <p>Exploring the data of natural history</p>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">About</h3>
      <center><p><a href="/about" target="_blank"><img src="/assets/img/about_icon.png" alt="" height="18" width="18" </a></a></p></center>
    </section>
    <section class="contact">
      <h3 class="contact-title">Contact Us</h3>
      <ul>
        
          <li><a href="https://twitter.com/ofcuriositydata" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
        
        
          <li class="github"><a href="http://github.com/cabinetofcuriosity" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
          <li class="email"><a href="mailto:ofcuriositydata"><i class="fa fa-envelope-o"></i></a></li>
        
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2018 &copy; Cabinet of Curiosity</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    <div class="page-cover-image">
      <img class="page-image" src=/assets/img/neotoma_part1.png alt="Neotoma Part I: retrieving all the mammal data">
    </div> <!-- End Page Cover Image -->
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">Neotoma Part I: retrieving all the mammal data</h1>
        <div class="page-date"><span>2018, Mar 19&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <h2 id="about-neotoma">About Neotoma</h2>

<p>The first database I wanted to explore was Neotoma. Neotoma is a Paleoecological database that stores many different types of data. It focuses on  data from 5.333 million years ago (Paleocene) to now.  The majority of the data is from collection sites, where scientists collected and carefully characterized what they found and their best guess on the geological age in which it was collected. The  ranges from diatoms to pollen to insects and bones.  Bones! So cool.</p>

<p>Neotoma is implemented in a Microsoft SQL server, but sadly my SQL skills are less then optimal. So I just googled “Neotoma R Package” and was so thrilled to find an API wrapper package which is part of my favorite R community <a href="https://ropensci.org/">Ropensci</a>! The package is called <a href="https://github.com/ropensci/neotoma">Neotoma</a> and it magically opened up all the data to me. I would like to immediately thank everyone who put in time to make this this tool, especially Simon Goring, who appears to have spear headed this project.</p>

<p><strong>Note</strong>: If you are an SQL wizard, you are in luck, this database is extensive and has excellent documentation. You can read about all the details in the <a href="https://neotoma-manual.readthedocs.io/en/latest/neotoma_introduction.html">Neotoma Database Manual</a>.</p>

<h2 id="set-up">Set up</h2>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Libraries I used</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">devtools</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">neotoma</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span><span class="w">

</span><span class="c1">## To install Neotoma</span><span class="w">
</span><span class="c1">## install_github("ropensci/neotoma")</span><span class="w">
</span></code></pre></div></div>

<h2 id="exploring-with-a-short-example">Exploring with a short example</h2>

<p>The <code class="highlighter-rouge">neotoma::get_table()</code> function allows you to retrieve whole datasets. This is a superfast way to get to the data as a data frame. Go here for a <a href="http://api.neotomadb.org/doc/resources/dbtables">list of all 63 the tables</a>. These can be accessed using <code class="highlighter-rouge">get_table()</code> function and is a way to search through the database by specific parameters.</p>

<p>For instance, if you are interested in a particular species, age, altitude, ect. you can use the <code class="highlighter-rouge">neotoma::get_dataset</code>. Let’s try searching by <code class="highlighter-rouge">taxonname</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Smilodon = sabertooth tiger. </span><span class="w">
</span><span class="c1">## * = wildcard which means anything character after </span><span class="w">
</span><span class="n">smilodon</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_dataset</span><span class="p">(</span><span class="n">taxonname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Smilodon*'</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The API call was successful, you have returned 31 records.
</code></pre></div></div>

<p>If you call the <code class="highlighter-rouge">smilodon</code> object, you get a nice summary table of all the data.set.ids. The actual object structure you get back is a “large data list” of objects which include yet more lists of objects.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Checking the structure of data returned</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">smilodon</span><span class="p">)</span><span class="w"> </span><span class="c1"># structure of whole object</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">smilodon</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="w"> </span><span class="c1">#structure of one object in the list.</span><span class="w">
</span></code></pre></div></div>

<p>In the end, the get <code class="highlighter-rouge">get_dataset</code> function is giving you information about which datasets (and their IDs) include “Smilodon*” samples. The most important information is the dataset ID, which can guide you to more information about all the samples in these datasets because at this point, all you have is the dataset site information. At this point, you can use the <code class="highlighter-rouge">get_site()</code> function to get a nice data frame to actually use.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get_site</span><span class="p">(</span><span class="n">smilodon</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                     site.name       long      lat elev
 Blackwater Draw Loc. 1                        -103.31667 34.28333 1280
 Avery Island                                   -91.75000 29.86667   NA
 Clamp Cave                                     -98.75000 31.11667   NA
 Friesenhahn Cave                               -98.36667 29.61667   NA
 First American Bank [40DV40]                   -86.78333 36.18333  113
 Rancho La Brea                                -118.35600 34.06294   54
 Rancho La Brea                                -118.35600 34.06294   54
 Rancho La Brea                                -118.35600 34.06294   54
 Rancho La Brea                                -118.35600 34.06294   54
 Rancho La Brea                                -118.35600 34.06294   54
 Rancho La Brea                                -118.35600 34.06294   54
 Rancho La Brea                                -118.35600 34.06294   54
 Hawver Cave [UCMP 1069]                       -120.86667 38.86667  393
 Maricopa [Maricopa Brea] [LACM 6731]          -119.36667 35.00000  305
 McKittrick [UCMP 1370]                        -119.61667 35.31667  300
 San Pedro Lumber Company [UCMP V2047]         -118.25000 33.75000   NA
 Carpinteria [LACM 139]                        -119.50500 34.38583   18
 ...
A site object containing 31 sites and 8 parameters.
</code></pre></div></div>

<p>There are a bunch of great functions to call the specific data you might be interested.  To look at all the functions this package has to offer, check out the <a href="https://cran.r-project.org/web/packages/neotoma/neotoma.pdf">documentation</a>.</p>

<h2 id="exploring-with-large-example">Exploring with large example</h2>

<p>I basically want to visualize <strong>everything</strong> that the database has to offer. Of course that would mean downloading the entire database, which I shouldn’t do because it is too big. I limited my question to an aspect of the dataset I was interested in: <em>What is the distribution of animal samples through time?</em></p>

<p>My R work flow is always motivated by the question: How do I get to a data frame that I can play with in ggplot? Which translates into organizing all the data that interests me into a data frame in the <a href="https://vita.had.co.nz/papers/tidy-data.pdf">tidy format</a>, where each sample is a row.</p>

<p>The key to getting all the data I wanted was the <code class="highlighter-rouge">get_data()</code> function which allows me to download all the data for a given site. I wanted all the species information in the <code class="highlighter-rouge">vertebrate fauna</code> dataset, which is still a lot of data, but manageable.</p>

<p>To start I explored what was in these site datasets by just looking at two.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">IDs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4657</span><span class="p">,</span><span class="w"> </span><span class="m">4560</span><span class="p">)</span><span class="w"> </span><span class="c1"># just grabbed two random ones</span><span class="w">
</span><span class="n">test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_download</span><span class="p">(</span><span class="n">IDs</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>API call was successful. Returned record for Murphy's Old House[36AR129]
API call was successful. Returned record for Lindenmeier [5LR13]
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">IDs</span><span class="p">)</span><span class="w">  </span><span class="c1"># To look at the data structure of what I downloaded.</span><span class="w">
</span></code></pre></div></div>

<p>It seems that all the data I really want is in the <code class="highlighter-rouge">taxon.list</code> data frame and the <code class="highlighter-rouge">chronologies</code> info.</p>

<p>In the <code class="highlighter-rouge">taxon.list</code> section I get a nice description of the sample. Including what kind of fragment I found (bone, antler, ect) and the <code class="highlighter-rouge">taxon.name</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">test</span><span class="o">$</span><span class="n">`4560`</span><span class="o">$</span><span class="n">taxon.list</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>             taxon.name variable.units variable.element variable.context
1 Antilocapra americana            MNI       bone/tooth             &lt;NA&gt;
2 Antilocapra americana           NISP       bone/tooth             &lt;NA&gt;
3          Camelops sp.            MNI       bone/tooth      redeposited
4          Camelops sp.           NISP       bone/tooth      redeposited
5         Canis latrans            MNI       bone/tooth             &lt;NA&gt;
  taxon.group ecological.group                                    alias
1     Mammals             ARTI     Antilocapra americana|bone/tooth|MNI
2     Mammals             ARTI    Antilocapra americana|bone/tooth|NISP
3     Mammals             ARTI  Camelops sp.|redeposited|bone/tooth|MNI
4     Mammals             ARTI Camelops sp.|redeposited|bone/tooth|NISP
5     Mammals             CARN             Canis latrans|bone/tooth|MNI
</code></pre></div></div>

<p>In the chronologies section, I get one line defining when in time the excavation site represents, <code class="highlighter-rouge">age.older</code> and <code class="highlighter-rouge">age.younger</code> and how that age was determined, <code class="highlighter-rouge">age.type</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test</span><span class="o">$</span><span class="n">`4560`</span><span class="o">$</span><span class="n">chronologies</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$`FAUNMAP 1.1`
  age.older age age.younger chronology.name             age.type
1     11200  NA        8400     FAUNMAP 1.1 Radiocarbon years BP
  chronology.id dataset.id
1          2039       4560
</code></pre></div></div>

<p>Therefore, to get to all of the data I am interested in I 1. got all the dataset IDs from all the <code class="highlighter-rouge">vertebrate fauna</code> datasets 2. designed an empty data frame to collect information and 3. used the IDs to retrieve the <code class="highlighter-rouge">taxon.list</code> and <code class="highlighter-rouge">chronologies</code> info on each record.</p>

<p>To retrieve ALL THE DATA:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## 1. Get all IDs</span><span class="w">
</span><span class="n">all_fauna</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_dataset</span><span class="p">(</span><span class="n">datasettype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"vertebrate fauna"</span><span class="p">)</span><span class="w"> </span><span class="c1">#3915 records</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The API call was successful, you have returned 3919 records.
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">IDs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">all_fauna</span><span class="p">)</span><span class="w">
</span><span class="n">IDs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">IDs</span><span class="p">)</span><span class="w">

</span><span class="c1">## 2. Make empty dataframe to populate ALL THE DATA</span><span class="w">
</span><span class="n">output_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">13</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
</span><span class="n">col_names</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">test</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">taxon.list</span><span class="p">),</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">test</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">dataset</span><span class="o">$</span><span class="n">site</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]),</span><span class="w"> </span><span class="s2">"iteration"</span><span class="p">,</span><span class="w"> </span><span class="s2">"age.older"</span><span class="p">,</span><span class="w"> </span><span class="s2">"age.younger"</span><span class="p">)</span><span class="w">

</span><span class="n">colnames</span><span class="p">(</span><span class="n">output_df</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">col_names</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">output_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] taxon.name       variable.units   variable.element variable.context
 [5] taxon.group      ecological.group site.id          site.name       
 [9] long             lat              iteration        age.older       
[13] age.younger     
&lt;0 rows&gt; (or 0-length row.names)
</code></pre></div></div>

<p>Now that I have a nice home for my data, I created a loop to download all the data from the Neotoma database. This takes a lot of time to run, I didn’t time it, but be prepared to wait if you want to run this. <strong>The finished dataframe can be downloaded</strong>:  <a href="/assets/downloads/all_fauna_data.csv" target="_blank">all_fauna_data.csv</a></p>

<p><strong>Note</strong>: Some of the chronologies had multiple dates for <code class="highlighter-rouge">age.older</code> and <code class="highlighter-rouge">age.younger</code>, so I had to just grab the first age. Look at <a href="http://neotoma-manual.readthedocs.io/en/latest/db_design_concepts.html#chronology">Neotoma database manual</a> for how chronology is determined for each site.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## 3. gimmie all the data</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">all_fauna</span><span class="p">))){</span><span class="w">
    
    </span><span class="c1"># gather info from each data ID in dataframe format</span><span class="w">
     </span><span class="n">temp_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all_fauna</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">taxon.list</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">]</span><span class="w">
     </span><span class="n">temp_data</span><span class="o">$</span><span class="n">site.id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all_fauna</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">dataset</span><span class="o">$</span><span class="n">site</span><span class="o">$</span><span class="n">site.id</span><span class="w">
     </span><span class="n">temp_data</span><span class="o">$</span><span class="n">site.name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all_fauna</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">dataset</span><span class="o">$</span><span class="n">site</span><span class="o">$</span><span class="n">site.name</span><span class="w">
     </span><span class="n">temp_data</span><span class="o">$</span><span class="n">long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all_fauna</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">dataset</span><span class="o">$</span><span class="n">site</span><span class="o">$</span><span class="n">long</span><span class="w">
     </span><span class="n">temp_data</span><span class="o">$</span><span class="n">lat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all_fauna</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">dataset</span><span class="o">$</span><span class="n">site</span><span class="o">$</span><span class="n">lat</span><span class="w">
     </span><span class="n">temp_data</span><span class="o">$</span><span class="n">lat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all_fauna</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">dataset</span><span class="o">$</span><span class="n">site</span><span class="o">$</span><span class="n">lat</span><span class="w">
     </span><span class="n">temp_data</span><span class="o">$</span><span class="n">iteration</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">i</span><span class="w">
     
     </span><span class="c1">## Need to specify only first number, since many have multiple, age.older and age.younger dates</span><span class="w">
     </span><span class="c1">## Also, need to specify when null condition</span><span class="w">
     </span><span class="n">temp_data</span><span class="o">$</span><span class="n">age.older</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">all_data</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">chronologies</span><span class="o">$</span><span class="n">`FAUNMAP 1.1`</span><span class="o">$</span><span class="n">age.older</span><span class="p">[</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">all_fauna</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">chronologies</span><span class="o">$</span><span class="n">`FAUNMAP 1.1`</span><span class="o">$</span><span class="n">age.older</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="s2">"NA"</span><span class="p">)</span><span class="w">
     </span><span class="n">temp_data</span><span class="o">$</span><span class="n">age.younger</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">all_fauna</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">chronologies</span><span class="o">$</span><span class="n">`FAUNMAP 1.1`</span><span class="o">$</span><span class="n">age.younger</span><span class="p">[</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">all_fauna</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">chronologies</span><span class="o">$</span><span class="n">`FAUNMAP 1.1`</span><span class="o">$</span><span class="n">age.younger</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="s2">"NA"</span><span class="p">)</span><span class="w">
     
     </span><span class="c1"># rbind to the rest</span><span class="w">
     </span><span class="n">output_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">output_df</span><span class="p">,</span><span class="w"> </span><span class="n">temp_data</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">## Print out dataframe so I never have to run that loop again</span><span class="w">
</span><span class="c1">## write.csv(output_df, "all_fauna_data.csv", row.names = FALSE)</span><span class="w">
</span></code></pre></div></div>

<h2 id="checking-and-summarizing">Checking and summarizing</h2>

<p>Yes! I have all the data I need to start exploring. What I love about this dataset is that it allows me to daydream about what it was like on earth thousands and millions of years ago. Each site is a time capsule documenting a a specific time in earth’s history and the bones are from an animal that was once alive roaming the earth living and struggling to survive.</p>

<p>The first few questions I always ask pertain to just understanding the data.
What is this data? How much of it do I have? What is the distribution of sample types? This is actually one of my favorite parts of data analysis.</p>

<p><strong>Note</strong>: I just read a great blog post by David Ranzolin: <a href="https://daranzolin.github.io/articles/2018-01/preeda">The Data Analyst as Wanderer: Pre-Exploratory Data Analysis with R</a>. It outlines how he approaches exploring data he has never seen before.</p>

<p>If you didn’t run chunk above, you can download: <a href="/assets/downloads/all_fauna_data.csv" target="_blank">all_fauna_data.csv</a></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Read in from checkpoint</span><span class="w">
</span><span class="n">output_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/all_fauna_data.csv"</span><span class="p">)</span><span class="w">

</span><span class="c1">## Check out all the pretty data</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">output_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	44468 obs. of  13 variables:
 $ X               : int  1 2 3 4 5 6 7 8 9 10 ...
 $ taxon.name      : Factor w/ 1768 levels "?Alces alces",..: 127 157 190 244 248 762 839 916 1027 1061 ...
 $ variable.units  : Factor w/ 8 levels "1-4 scale","grams",..: 7 7 7 7 7 7 7 7 7 7 ...
 $ variable.element: Factor w/ 312 levels "antler","antorbital",..: 16 13 16 16 16 16 16 16 16 16 ...
 $ variable.context: Factor w/ 5 levels "articulated",..: NA NA NA NA NA NA NA NA NA NA ...
 $ taxon.group     : Factor w/ 9 levels "Birds","Crustaceans undiff.",..: 6 1 6 6 6 6 6 6 6 6 ...
 $ site.id         : int  3531 3531 3531 3531 3531 3531 3531 3531 3531 3531 ...
 $ site.name       : Factor w/ 3372 levels "101 Ranch","10AA15",..: 768 768 768 768 768 768 768 768 768 768 ...
 $ long            : num  -106 -106 -106 -106 -106 ...
 $ lat             : num  40.9 40.9 40.9 40.9 40.9 ...
 $ iteration       : int  1 1 1 1 1 1 1 1 1 1 ...
 $ age.older       : num  11980 11980 11980 11980 11980 ...
 $ age.younger     : num  1450 1450 1450 1450 1450 1450 1450 1450 1450 1450 ...
</code></pre></div></div>

<p>What is the size of this dataset? Great! I have 44,468 samples.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">dim</span><span class="p">(</span><span class="n">output_df</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 44468    13
</code></pre></div></div>

<h2 id="visualizing">Visualizing</h2>

<p>What type of <code class="highlighter-rouge">taxon.groups</code> do I have?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Summarize the taxon.groups</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">output_df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">taxon.group</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"count"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> 
</span></code></pre></div></div>

<p><img src="../assets/img/2018-03-20-retrieving-summary-neotoma_files/figure-html/unnamed-chunk-10-1.png" alt="" /><!-- --></p>

<p>Looks like the Fauna dataset is mostly made up of mammals anyway, so I am just going to remove anything else to narrow my questions a bit.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mammals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">output_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">taxon.group</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Mammals"</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<p>Great, I still have 39,739 samples.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">dim</span><span class="p">(</span><span class="n">mammals</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 39739    13
</code></pre></div></div>

<p>Out of all the bone, teeth, antler, fragments, what taxa are the most sampled?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mammals</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">count</span><span class="p">(</span><span class="n">taxon.name</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">top_n</span><span class="p">(</span><span class="m">35</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">taxon.name</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Taxon Name"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../assets/img/2018-03-20-retrieving-summary-neotoma_files/figure-html/unnamed-chunk-11-1.png" alt="" /><!-- --></p>

<p>I don’t know what most of these species are! With the exception of <em>Bison bison</em> (which is Bison or buffalo) and <em>Homo sapiens</em>. To just explore a few of the other species I just Googled some ones that interested me. <em>Odocoileus virginianus</em> is white tail deer, which makes perfect sense - these guys are everywhere. The cotton tail rabbit, <em>Sylvilagus</em>, is represented twice, one as a subgenus and once as a specific species. Good to note in the future, taxon names can mean a few different things. I saw <em>Neotoma</em> and was like “wait, that’s the database” and thought it was some error in the data, but really it is the sub-genus of pack rats! What a brilliant name for the database.  Bravo Neotoma database namer whomever you are. I like you.</p>

<p>Googling the taxa is taking too much time and there are, let’s see…</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">mammals</span><span class="o">$</span><span class="n">taxon.name</span><span class="p">))</span><span class="w"> 
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 1338
</code></pre></div></div>

<p>…1338 unique species/sub species represented in this data. Googling is going to take forever! It would be awesome if I could characterize them easier. Because doing any sort of visualization on 1,338 unique grouping will be confusing, I would like to represent them in higher order groups. AND OMG I CAN with another Ropensci package: <a href="https://github.com/ropensci/taxize">taxize</a>. This package even allows to find the common names of species easier, no more Googling each species one at a time.</p>

<h2 id="next-time">Next Time</h2>

<p>I am going to delve into the data a bit more, visualizing the distribution of data in time and space, interact with the <a href="https://github.com/ropensci/taxize">taxize</a> database, and start asking what questions the data has to offer.</p>

<h2 id="thanks">Thanks</h2>

<p>Data were obtained from the <a href="http://www.neotomadb.org">Neotoma Paleoecology Database</a>, and the work of the data contributors and the Neotoma community is gratefully acknowledged.</p>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://www.neotomadb.org/">Neotoma Database Website</a></li>
  <li><a href="https://ropensci.org/">Ropensci</a></li>
</ul>


      <div class="page-footer">
        <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=Neotoma Part I: retrieving all the mammal data&url=http://localhost:4000/retrieving-summary-neotoma/" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=http://localhost:4000/retrieving-summary-neotoma/" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=http://localhost:4000/retrieving-summary-neotoma/" title="Share on Google+" rel="nofollow" target="_blank">Google+</a>
        </div>
        <div class="page-tag">
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
    <div id="disqus_thread" class="article-comments"></div>
    <script>
      (function() {
          var d = document, s = d.createElement('script');
          s.src = '//cabinetofcuriosity.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-116118773-1', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
